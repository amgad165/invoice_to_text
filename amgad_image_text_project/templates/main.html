{% extends "basic.html" %}
{% load static %} 

{% block header %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    {% comment %} <link rel="stylesheet" href="https://cdn.jsdelivr.net/themify-icons/0.1.2/css/themify-icons.css"> {% endcomment %}
    <script type="text/javascript" src="/static/assets/js/jquery-3.5.1.min.js"></script>


    <style>
         /* background:  url({% static 'images/email_sending.gif' %} ) no-repeat center center; */
#loading_gif{
 
background:  url(/static/images/loader.gif) no-repeat center center;
  height: 100vh;
  background-size: 12%;
  width: 90%;
  position: absolute;
  z-index: 100;
  margin: auto;
  margin-top: 10px;
  left: 0;
  right: 0;
  text-align: center;
}


@media screen and (max-width: 767px) {
    #loading_gif{
 
 background:  url(/static/images/loader.gif) no-repeat center center;
   height: 100vh;
   background-size: 75%;
   width: 90%;
   position: absolute;
   z-index: 100;
   margin: auto;
   margin-top: 10px;
   left: 0;
   right: 0;
   text-align: center;
 }
}

    </style>
{% endblock header %}
{% block body %}


  

    <div style="margin-top: 30px;" >
        <div class='d-flex justify-content-center' id="file_form">
            <form enctype='multipart/form-data'  >
                {% csrf_token %}
                <div class="row">
                    <div class="col-1"></div>
                <div class="col-8">
                    <select class="form-select custom-select-lg mb-3" id='type' name='type'>
                        <option value="PDF">PDF</option>
                        <option selected value="image">Image</option>
                      </select>
                </div> 
            </div>
                <div class="upload-files-container">
                    <div class="drag-file-area">
                        <span class="material-icons-outlined upload-icon"> upload_file </span>
                        <h3 class="dynamic-message"> Drag & drop any file here </h3>
                        <label style='display: block' class='label'> or <span class="browse-files">
                                <input type="file" accept="image/* , .pdf" class="default-file-input" id="file_input" name="doc_file" />
                                <br>
                                <span class="browse-files-text">browse file</span>
                                <span>from device</span> </span>
                        </label>
                    </div>
                    <span class="cannot-upload-message"> <span class="material-icons-outlined">error</span> Please
                        select a file first <span class="material-icons-outlined cancel-alert-button">cancel</span>
                    </span>
                    <div class="file-block">
                        <div class="file-info"> <span class="material-icons-outlined file-icon">description</span> 
                            <span
                                class="file-name"> </span> | <span class="file-size"> </span> </div>
                        <span class="material-icons remove-file-icon">delete</span>
                        <div class="progress-bar"> </div>
                    </div>
                    <button id="upload-image" type="button" class="upload-button">Upload</button>
                </div>
            </form>
            <div id='row_gif' class="row"></div> 
        </div>

      
<div  class="row">
  <div class="col-4"></div>
        <div class="col-3" id="result"></div>   
      </div>
          <section id="sec_services">
            <div class="row">
         <div class="col-1"></div>
            <div class="services-grid ">
              <div id="image1" class="service service2 col-lg-3 col-12">
                <i class="ti-gallery"></i>
                <h4>Image to csv, excel</h4>
                <p>extract date, description and money from bank statements and invoices</p>
                <a id='submit1' href="{% url 'img_to_table_view'  %}" class="cta"><button type="button" class="btn btn-primary">Convert</button></a>
                
              </div>
          
              <div id="image2" class="service service2 col-lg-3">
                <i class="ti-pencil"></i>
                <h4>Image to text</h4>
                <p>Convert your image to normal text and download as txt / word doc file</p>
                <a id='submit2' href="{% url 'img_to_text_view'  %}" class="cta"><button type="button" class="btn btn-primary">Convert</button></a>
              </div>
          
              <div id="pdf" class="service service3 col-lg-3">
                <i class="ti-files"></i>
                <h4>PDF to text</h4>
                <p>Convert your PDF to normal text and download as txt / word doc file</p>
                <a  id='submit3' href="{% url 'pdf_to_text_view'  %}" class="cta"><button type="button" class="btn btn-primary">Convert</button></a>
              </div>
            </div>
            <div class="col-2"></div>

          </div>
          </section>
   
  
      
      
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script> -->
    <script src='{% static "index.js" %}'></script>
<!-- 
    <script>
        const imageForm = document.getElementById("imageForm");
        const cameraInput = document.getElementById("cameraInput");
        if (imageForm) {
            
        
        imageForm.addEventListener("submit", function(event) {
        event.preventDefault();

        const file = cameraInput.files[0];

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function() {
            const imageData = reader.result;

            sendImageToServer(imageData);
        };
        });
    }
        function sendImageToServer(imageData) {
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/upload_file", true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send(`imageData=${imageData}`);
        
        }





    </script> -->
    <script>
        $('#submit1').on("click", function (e) {
       
         $("#row_gif").append('<div id="loading_gif"></div>');
       
         var loader = document.getElementById("loading_gif");
         window.addEventListener("load",function () {
           loader.style.display = "none";
         })
        });
       
       </script>

<script>
    $('#submit2').on("click", function (e) {
   
     $("#row_gif").append('<div id="loading_gif"></div>');
   
     var loader = document.getElementById("loading_gif");
     window.addEventListener("load",function () {
       loader.style.display = "none";
     })
    });
   
   </script>

<script>
    $('#submit3').on("click", function (e) {
   
     $("#row_gif").append('<div id="loading_gif"></div>');
   
     var loader = document.getElementById("loading_gif");
     window.addEventListener("load",function () {
       loader.style.display = "none";
     })
    });
   
   </script>

<script>
  $(document).ready(function() {

    document.getElementById("sec_services").style.display = "none";
    
      $('#upload-image').click(function() {
          var fileInput = $('#file_input')[0];
          var type = $('#type').val()
          console.log(type)
          var file = fileInput.files[0];
          var reader = new FileReader();
          reader.onload = function(event) {
              var imageData = event.target.result;
              $.ajax({
                  url: '/upload_file',
                  type: 'POST',
                  data: {
                      'image_data': imageData,
                      'type' : type,
                      csrfmiddlewaretoken: '{{ csrf_token }}',
                  },
                  success: function(response) {
                    console.log('hs')
                    if (type =='image') {
                        document.getElementById("sec_services").style.display = "block";
                        document.getElementById("pdf").style.display = "none";
                    }
                    else{
                        document.getElementById("sec_services").style.display = "block";
        
                        document.getElementById("image1").style.display = "none";
                        document.getElementById("image2").style.display = "none";

                    }
                      // alert('Image uploaded successfully');
                      // $("#result").html('<div class="alert alert-success"><button type="button" class="close">Ã—</button>'+'Image Uploaded succesfully'+'</div>');

                  },
                  error: function(xhr, status, error) {
                      alert('Error uploading image: ' + error);
                  }
              });
          };
          reader.readAsDataURL(file);
      });
  });
</script>
</body>
{% endblock body %}